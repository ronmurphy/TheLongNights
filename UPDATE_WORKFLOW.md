# 🔄 Auto-Update System - Setup & Workflow

## ✅ Setup Complete!

The auto-update system is now configured and ready to use. Players can check for updates via the menu: **Help → Check for Updates...**

---

## 📦 How It Works

1. **Player opens game** → Sees "Help" menu
2. **Clicks "Check for Updates..."** → App checks GitHub Releases
3. **If update available** → Dialog: "New version X.X.X available! Download?"
4. **Player clicks "Download"** → Update downloads in background
5. **Download complete** → Dialog: "Update ready! Restart now or later?"
6. **Player restarts** → Update installs automatically

---

## 🚀 Publishing Updates (Your Workflow)

### Step 1: Install electron-updater
```bash
npm install
```

### Step 2: Build the New Version
```bash
npm run build-electron-win
```

This creates:
- `dist-electron/TheLongNights-0.6.5.exe` (installer)
- `dist-electron/TheLongNights-0.6.5-portable.exe` (portable)
- `dist-electron/latest.yml` (update metadata - IMPORTANT!)

### Step 3: Create GitHub Release

1. Go to: https://github.com/your-username/TheLongNights/releases
2. Click **"Create a new release"**
3. Fill in:
   - **Tag:** `v0.6.5` (must match package.json version!)
   - **Title:** `The Long Nights v0.6.5`
   - **Description:** Changelog (what's new/fixed)

4. **Upload files** (drag & drop):
   - ✅ `TheLongNights-0.6.5-portable.exe` (150MB)
   - ✅ `latest.yml` (CRITICAL - tells app about update!)
   - ✅ (Optional) `TheLongNights-0.6.5.exe` (installer)

5. Click **"Publish release"**

### Step 4: Done!

Players can now click "Help → Check for Updates" and get your new version!

---

## 📝 Important Files

### `latest.yml` (Auto-generated by electron-builder)
```yaml
version: 0.6.5
files:
  - url: TheLongNights-0.6.5-portable.exe
    sha512: abc123...
    size: 157286400
path: TheLongNights-0.6.5-portable.exe
sha512: abc123...
releaseDate: '2025-01-15T10:30:00.000Z'
```

**This file is REQUIRED!** It tells the app:
- What version is available
- Where to download it
- File size & checksum

---

## 🔧 Configuration

### package.json
```json
{
  "version": "0.6.5",  // ← Bump this before building!
  "build": {
    "publish": {
      "provider": "github",
      "owner": "your-github-username",  // ← Change this!
      "repo": "TheLongNights"           // ← And this!
    }
  }
}
```

### electron.cjs
```javascript
autoUpdater.autoDownload = false;        // User confirms before download
autoUpdater.autoInstallOnAppQuit = true; // Installs when app closes
```

---

## 🎮 Player Experience

### Menu Item
```
Help
  ├─ Check for Updates...   ← Click to check manually
  ├─ ─────────────────
  └─ About The Long Nights
```

### Update Available Dialog
```
╔════════════════════════════════════╗
║    Update Available                ║
╠════════════════════════════════════╣
║  A new version (0.6.5) is          ║
║  available!                        ║
║                                    ║
║  Would you like to download it     ║
║  now? The update will be installed ║
║  when you close the app.           ║
║                                    ║
║  [Download]  [Later]               ║
╚════════════════════════════════════╝
```

### Downloading
```
╔════════════════════════════════════╗
║    Downloading Update              ║
╠════════════════════════════════════╣
║  Downloading update in the         ║
║  background...                     ║
║                                    ║
║  You will be notified when it's    ║
║  ready to install.                 ║
║                                    ║
║  [OK]                              ║
╚════════════════════════════════════╝
```

### Update Ready
```
╔════════════════════════════════════╗
║    Update Ready                    ║
╠════════════════════════════════════╣
║  Update has been downloaded!       ║
║                                    ║
║  The update will be installed      ║
║  automatically when you close      ║
║  the app.                          ║
║                                    ║
║  [Restart Now]  [Later]            ║
╚════════════════════════════════════╝
```

---

## 🐛 Troubleshooting

### "Update Check Failed"
- **Check internet connection**
- **Verify GitHub repo is public** (or add GitHub token)
- **Check `latest.yml` exists in release**

### "No latest.yml in release"
- **Make sure you uploaded `latest.yml`** from `dist-electron/`
- It's auto-generated by `electron-builder`

### "Update not detected"
- **Version mismatch** - Release tag must match `package.json` version
- Tag format: `v0.6.5` (with v prefix)
- Package version: `"version": "0.6.5"` (no v prefix)

### "Download fails"
- **File too large** - GitHub Releases support up to 2GB per file ✅
- **Check file URL** in `latest.yml` matches uploaded filename

---

## 📊 Version Bump Workflow

### Quick Checklist
- [ ] Update `package.json` version: `0.6.4` → `0.6.5`
- [ ] Run `npm run build-electron-win`
- [ ] Create GitHub release with tag `v0.6.5`
- [ ] Upload `.exe` and `latest.yml`
- [ ] Publish release
- [ ] Test: Help → Check for Updates

### Semantic Versioning
```
v0.6.5
  │ │ └─ Patch (bug fixes)
  │ └─── Minor (new features, backwards compatible)
  └───── Major (breaking changes)
```

---

## 🔒 Security

- ✅ **SHA-512 checksums** - Verifies download integrity
- ✅ **HTTPS only** - GitHub Releases use HTTPS
- ✅ **Code signing** - (Optional) Sign .exe for Windows SmartScreen

---

## 💡 Tips

1. **Always test updates** before releasing
2. **Write clear changelogs** in release description
3. **Keep portable .exe size reasonable** (yours is 150MB - acceptable)
4. **Auto-increment version** using `bump-version.cjs` (already configured!)

---

## 📞 Need Help?

Common issues:
- **"Updates disabled" message** = Dev mode (expected - updates only work in production builds)
- **Players can't update** = Missing `latest.yml` in GitHub Release
- **Wrong version shows** = Tag doesn't match package.json version

---

## 🎉 Benefits

✅ No more manual downloads for players
✅ One-click updates
✅ Delta updates (only downloads changes)
✅ FREE hosting on GitHub Releases
✅ No file size issues (150MB is fine!)

**Condor and your testers will love it!** 🥤
