# ğŸ”„ Auto-Update System - Setup & Workflow

## âœ… Setup Complete!

The auto-update system is now configured and ready to use. Players can check for updates via the menu: **Help â†’ Check for Updates...**

---

## ğŸ“¦ How It Works

1. **Player opens game** â†’ Sees "Help" menu
2. **Clicks "Check for Updates..."** â†’ App checks GitHub Releases
3. **If update available** â†’ Dialog: "New version X.X.X available! Download?"
4. **Player clicks "Download"** â†’ Update downloads in background
5. **Download complete** â†’ Dialog: "Update ready! Restart now or later?"
6. **Player restarts** â†’ Update installs automatically

---

## ğŸš€ Publishing Updates (Your Workflow)

### Step 1: Install electron-updater
```bash
npm install
```

### Step 2: Build the New Version
```bash
npm run build-electron-win
```

This creates:
- `dist-electron/TheLongNights-0.6.5.exe` (installer)
- `dist-electron/TheLongNights-0.6.5-portable.exe` (portable)
- `dist-electron/latest.yml` (update metadata - IMPORTANT!)

### Step 3: Create GitHub Release

1. Go to: https://github.com/your-username/TheLongNights/releases
2. Click **"Create a new release"**
3. Fill in:
   - **Tag:** `v0.6.5` (must match package.json version!)
   - **Title:** `The Long Nights v0.6.5`
   - **Description:** Changelog (what's new/fixed)

4. **Upload files** (drag & drop):
   - âœ… `TheLongNights-0.6.5-portable.exe` (150MB)
   - âœ… `latest.yml` (CRITICAL - tells app about update!)
   - âœ… (Optional) `TheLongNights-0.6.5.exe` (installer)

5. Click **"Publish release"**

### Step 4: Done!

Players can now click "Help â†’ Check for Updates" and get your new version!

---

## ğŸ“ Important Files

### `latest.yml` (Auto-generated by electron-builder)
```yaml
version: 0.6.5
files:
  - url: TheLongNights-0.6.5-portable.exe
    sha512: abc123...
    size: 157286400
path: TheLongNights-0.6.5-portable.exe
sha512: abc123...
releaseDate: '2025-01-15T10:30:00.000Z'
```

**This file is REQUIRED!** It tells the app:
- What version is available
- Where to download it
- File size & checksum

---

## ğŸ”§ Configuration

### package.json
```json
{
  "version": "0.6.5",  // â† Bump this before building!
  "build": {
    "publish": {
      "provider": "github",
      "owner": "your-github-username",  // â† Change this!
      "repo": "TheLongNights"           // â† And this!
    }
  }
}
```

### electron.cjs
```javascript
autoUpdater.autoDownload = false;        // User confirms before download
autoUpdater.autoInstallOnAppQuit = true; // Installs when app closes
```

---

## ğŸ® Player Experience

### Menu Item
```
Help
  â”œâ”€ Check for Updates...   â† Click to check manually
  â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â””â”€ About The Long Nights
```

### Update Available Dialog
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    Update Available                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  A new version (0.6.5) is          â•‘
â•‘  available!                        â•‘
â•‘                                    â•‘
â•‘  Would you like to download it     â•‘
â•‘  now? The update will be installed â•‘
â•‘  when you close the app.           â•‘
â•‘                                    â•‘
â•‘  [Download]  [Later]               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Downloading
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    Downloading Update              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Downloading update in the         â•‘
â•‘  background...                     â•‘
â•‘                                    â•‘
â•‘  You will be notified when it's    â•‘
â•‘  ready to install.                 â•‘
â•‘                                    â•‘
â•‘  [OK]                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Update Ready
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    Update Ready                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Update has been downloaded!       â•‘
â•‘                                    â•‘
â•‘  The update will be installed      â•‘
â•‘  automatically when you close      â•‘
â•‘  the app.                          â•‘
â•‘                                    â•‘
â•‘  [Restart Now]  [Later]            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ› Troubleshooting

### "Update Check Failed"
- **Check internet connection**
- **Verify GitHub repo is public** (or add GitHub token)
- **Check `latest.yml` exists in release**

### "No latest.yml in release"
- **Make sure you uploaded `latest.yml`** from `dist-electron/`
- It's auto-generated by `electron-builder`

### "Update not detected"
- **Version mismatch** - Release tag must match `package.json` version
- Tag format: `v0.6.5` (with v prefix)
- Package version: `"version": "0.6.5"` (no v prefix)

### "Download fails"
- **File too large** - GitHub Releases support up to 2GB per file âœ…
- **Check file URL** in `latest.yml` matches uploaded filename

---

## ğŸ“Š Version Bump Workflow

### Quick Checklist
- [ ] Update `package.json` version: `0.6.4` â†’ `0.6.5`
- [ ] Run `npm run build-electron-win`
- [ ] Create GitHub release with tag `v0.6.5`
- [ ] Upload `.exe` and `latest.yml`
- [ ] Publish release
- [ ] Test: Help â†’ Check for Updates

### Semantic Versioning
```
v0.6.5
  â”‚ â”‚ â””â”€ Patch (bug fixes)
  â”‚ â””â”€â”€â”€ Minor (new features, backwards compatible)
  â””â”€â”€â”€â”€â”€ Major (breaking changes)
```

---

## ğŸ”’ Security

- âœ… **SHA-512 checksums** - Verifies download integrity
- âœ… **HTTPS only** - GitHub Releases use HTTPS
- âœ… **Code signing** - (Optional) Sign .exe for Windows SmartScreen

---

## ğŸ’¡ Tips

1. **Always test updates** before releasing
2. **Write clear changelogs** in release description
3. **Keep portable .exe size reasonable** (yours is 150MB - acceptable)
4. **Auto-increment version** using `bump-version.cjs` (already configured!)

---

## ğŸ“ Need Help?

Common issues:
- **"Updates disabled" message** = Dev mode (expected - updates only work in production builds)
- **Players can't update** = Missing `latest.yml` in GitHub Release
- **Wrong version shows** = Tag doesn't match package.json version

---

## ğŸ‰ Benefits

âœ… No more manual downloads for players
âœ… One-click updates
âœ… Delta updates (only downloads changes)
âœ… FREE hosting on GitHub Releases
âœ… No file size issues (150MB is fine!)

**Condor and your testers will love it!** ğŸ¥¤
